<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>GhostPass Pro â€” Activation</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: #f9fafb; color: #111827;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; height: 100vh; margin: 0; padding: 0 16px;
      text-align: center;
    }
    .card {
      background: #fff; padding: 28px 32px; border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,.08); max-width: 420px;
    }
    h1 { margin-top: 0; color: #111; }
    code {
      background: #f3f4f6; padding: 4px 8px; border-radius: 6px;
      font-size: 14px; word-break: break-all; display: inline-block;
      margin: 6px 0;
    }
    button {
      margin-top: 16px; background: #3b82f6; color: #fff; border: none;
      padding: 10px 18px; font-size: 15px; border-radius: 8px; cursor: pointer;
    }
    button:disabled { background: #9ca3af; cursor: default; }
    p.success { color: #16a34a; font-weight: 600; }
    p.error { color: #dc2626; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Thanks for upgrading to GhostPass&nbsp;Pro! ðŸŽ‰</h1>
    <p>Your payment was successful.</p>
    <p>Hereâ€™s your activation code:</p>
    <code id="session"></code>
    <p>Click below to activate GhostPass Pro automatically in your browser.</p>
    <button id="activateBtn">Activate&nbsp;Pro</button>
    <p id="status"></p>
  </div>

  <script>
    const session = new URLSearchParams(location.search).get('session_id');
    const codeEl = document.getElementById('session');
    const btn = document.getElementById('activateBtn');
    const status = document.getElementById('status');
    if (session) codeEl.textContent = session;
    else codeEl.textContent = 'No session ID found (contact support).';

    btn.addEventListener('click', async () => {
      if (!session) return;
      btn.disabled = true;
      status.textContent = 'Activating...';
      try {
        const CLAIM_URL = 'https://YOUR_VERCEL_URL.vercel.app/api/claim';
        const r = await fetch(`${CLAIM_URL}?session_id=${encodeURIComponent(session)}`);
        const j = await r.json();
        if (!r.ok || !j.token) throw new Error();
        // Send token to the extension to store
        chrome.runtime?.sendMessage?.({ type: 'CLAIM_TOKEN', token: j.token }, (reply) => {
          if (reply && reply.ok) {
            status.className = 'success';
            status.textContent = 'âœ… Pro activated! You can close this tab.';
          } else {
            status.className = 'error';
            status.textContent = 'Activation complete. If badge doesnâ€™t show PRO, reopen GhostPass.';
          }
        });
      } catch (e) {
        status.className = 'error';
        status.textContent = 'Activation failed. Please open GhostPass Options and paste this code manually.';
      }
    });
  </script>
</body>
</html>
